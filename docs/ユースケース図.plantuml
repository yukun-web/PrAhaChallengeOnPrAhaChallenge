@startuml
' プラハチャレンジ ユースケース図
left to right direction
skinparam packageStyle rectangle
skinparam shadowing false
skinparam usecase {
  BackgroundColor White
  BorderColor #888
  ArrowColor #666
}

actor 参加者 as Participant
actor 管理者 as Admin
rectangle システム {
  usecase "在籍ステータスを変更" as UC_ChangeEnrollment
  usecase "課題の進捗ステータスを変更" as UC_ChangeProgress
  usecase "自動チーム再編成" as UC_AutoRestructure
  usecase "チームが2名以下の通知メール送信" as UC_NotifyLowTeam
  usecase "1名のチームの自動合流" as UC_AutoMerge
  usecase "合流先の選定（最少人数／同数はランダム）" as UC_SelectDest
  usecase "合流先なしの通知メール送信" as UC_NotifyNoDest
  usecase "復帰時の自動所属（最少人数チームへ）" as UC_AutoAssignOnReturn
  usecase "5名になった場合の自動分解" as UC_AutoSplit
}

' アクターとユースケースの関連
Participant --> UC_ChangeEnrollment
Participant --> UC_ChangeProgress

' システム内部の振る舞い（include / extend）
UC_ChangeEnrollment --> UC_AutoRestructure : <<extend>>

UC_AutoRestructure --> UC_NotifyLowTeam : <<include>>
UC_AutoRestructure --> UC_AutoMerge : <<include>>
UC_AutoRestructure --> UC_AutoAssignOnReturn : <<include>>
UC_AutoRestructure --> UC_AutoSplit : <<include>>

UC_AutoMerge --> UC_SelectDest : <<include>>
UC_AutoAssignOnReturn --> UC_SelectDest : <<include>>
UC_AutoMerge --> UC_NotifyNoDest : <<extend>>

' 管理者は通知メールを受け取る
Admin <-- UC_NotifyLowTeam
Admin <-- UC_NotifyNoDest

' 制約・補足（注釈）
note right of UC_ChangeProgress
  進捗ステータスの遷移規則:
  未着手 -> 取組中 -> レビュー待ち -> 完了
  レビュー待ち -> 取組中 への戻し可
  完了 は変更不可
  変更できるのは所有者本人のみ
end note

note bottom of UC_AutoRestructure
  在籍ステータス変更に伴い自動実行:
  - 減少でチームが2名以下: 管理者へ通知
  - 1名チームが発生: 自動合流（最少人数優先/同数はランダム）
  - 復帰: 最少人数チームに自動所属
  - 5名になった場合: 自動で2チームへ分解（分け方は任意）
end note

@enduml